<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Puzzle | Beyond Good and Evil</title>
    <style>
        body {
            font-family: 'Palatino', serif;
            background: #f9f4e8;
            color: #3a3226;
            max-width: 700px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        h1 {
            color: #8b0000;
            border-bottom: 2px dashed #8b0000;
        }
        .audio-container {
            margin: 30px 0;
        }
        button {
            background: #8b0000;
            color: #fff;
            border: none;
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #6b0000;
        }
        .hint {
            font-style: italic;
            margin: 20px 0;
            color: #666;
        }
        #spectrogram {
            width: 100%;
            margin: 20px auto;
            border: 1px solid #ddd;
            display: none;
        }
    </style>
</head>
<body>
    <h1>The Philosopher's Cipher</h1>
    <p>Listen closely. The truth hides where the ear fails...</p>
    
    <div class="audio-container">
        <audio id="hiddenAudio" controls>
            <source src="https://github.com/piyushannigeri/puzzle/blob/main/audio.wav?raw=true" type="audio/wav">
            Your browser does not support the audio element.
        </audio>
    </div>
    
    <button onclick="document.getElementById('hiddenAudio').play()">Play</button>
    <button onclick="downloadAudio()">Download</button>
    <button onclick="showHint()">Reveal Hint</button>
    
    <p id="hintText" class="hint" style="display:none;">
        <strong>Hint:</strong> Open this audio in <a href="https://www.audacityteam.org/" target="_blank">Audacity</a> or 
        <a href="https://www.sonicvisualiser.org/" target="_blank">Sonic Visualizer</a>. 
        Look for patterns beyond human hearing.
    </p>
    
    <canvas id="spectrogram"></canvas>
    
    <script>
        // Download audio
        function downloadAudio() {
            const link = document.createElement('a');
            link.href = 'https://github.com/piyushannigeri/puzzle/blob/main/audio.wav?raw=true';
            link.download = 'nietzsche_puzzle.wav';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Show hint
        function showHint() {
            document.getElementById('hintText').style.display = 'block';
        }
        
        // Optional: Basic spectrogram visualization (WebAudio API)
        // Note: For a full spectrogram, use libraries like Wavesurfer.js
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const analyser = audioCtx.createAnalyser();
        const canvas = document.getElementById('spectrogram');
        const ctx = canvas.getContext('2d');
        
        document.getElementById('hiddenAudio').addEventListener('play', function() {
            const source = audioCtx.createMediaElementSource(this);
            source.connect(analyser);
            analyser.connect(audioCtx.destination);
            visualize();
        });
        
        function visualize() {
            canvas.style.display = 'block';
            const WIDTH = canvas.width = 600;
            const HEIGHT = canvas.height = 200;
            analyser.fftSize = 256;
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            
            function draw() {
                requestAnimationFrame(draw);
                analyser.getByteFrequencyData(dataArray);
                ctx.fillStyle = 'rgb(200, 200, 200)';
                ctx.fillRect(0, 0, WIDTH, HEIGHT);
                const barWidth = (WIDTH / bufferLength) * 2.5;
                let x = 0;
                for (let i = 0; i < bufferLength; i++) {
                    const barHeight = dataArray[i] / 2;
                    ctx.fillStyle = `rgb(100, ${barHeight + 100}, 50)`;
                    ctx.fillRect(x, HEIGHT - barHeight, barWidth, barHeight);
                    x += barWidth + 1;
                }
            }
            draw();
        }
    </script>
</body>
</html>
